<!--
 * @Author: Shuai Wang
 * @Github: https://github.com/wsustcid
 * @Version: 1.0.0
 * @Date: 2021-09-27 17:52:51
 * @LastEditTime: 2021-10-14 10:59:36
-->
- [5. 行为规划原理](#5-行为规划原理)
  - [5.1 行为规划器](#51-行为规划器)
    - [5.1.1 驾驶决策行为](#511-驾驶决策行为)
    - [5.1.2 行为规划器输出](#512-行为规划器输出)
    - [5.1.3 行为规划器输入](#513-行为规划器输入)
    - [5.1.4 有限状态机](#514-有限状态机)
  - [5.2 处理没有动态目标的交叉路口场景](#52-处理没有动态目标的交叉路口场景)
    - [5.2.1 离散化交叉口](#521-离散化交叉口)
    - [5.2.2 状态机状态](#522-状态机状态)
    - [5.2.3 状态机转移](#523-状态机转移)
    - [5.2.4 处理环境噪声](#524-处理环境噪声)
    - [5.2.5 行为规划器测试](#525-行为规划器测试)
  - [5.3 处理包含动态目标的交叉路口场景](#53-处理包含动态目标的交叉路口场景)
    - [5.3.1 有限状态机状态](#531-有限状态机状态)
    - [5.3.2 有限状态机转移](#532-有限状态机转移)
    - [5.3.3 进一步提升](#533-进一步提升)
  - [5.4 同时处理多种场景](#54-同时处理多种场景)
    - [5.4.1 多个状态机](#541-多个状态机)
  - [5.5 行为规划高级方法](#55-行为规划高级方法)
    - [5.5.1 专家系统](#551-专家系统)
    - [5.5.2 模糊逻辑](#552-模糊逻辑)
    - [5.5.3 强化学习](#553-强化学习)
    - [5.5.4 机器学习](#554-机器学习)
  - [5.6 补充阅读材料](#56-补充阅读材料)


# 5. 行为规划原理
## 5.1 行为规划器
行为规划系统通过规划出一系列高层级的驾驶动作或决策行为来保证无人驾驶车辆各种驾驶场景下都能够安全的完成相关驾驶任务。

在设计行为规划器待规划的决策行为时，需要考虑如下因素：
  - 道路交通规则
  - 车辆周围的静态目标
  - 车辆周围的动态目标

以车辆到达一个繁忙的交叉口为例，行为规划器主要考虑以下决策行为：
  - 应该在何时、何地停车
  - 在停车点停留多久
  - 何时通过交叉口

对行为规划器的要求：
  - 高效性：行为规划器需要高效的完成此类决策任务，只有这样，当环境变化时，他才能快速的做出反应
  - 鲁棒性：行为规划器能够接受不够精准的输入，比如由于测量噪声所造成的干扰、感知误差所造成的错误检测等

### 5.1.1 驾驶决策行为
我们主要考虑五种车辆决策行为：
  - Track Speed: 使车辆保持在当前道路的限速上
  - Follow Leader: 和前方车辆速度保持匹配并维持一个安全的跟车距离
  - Decelerate to Stop: 当在规划空间内存在一个停止点时，车辆应不断减速直至停在停止点处
  - Stay Stopped: 在当前位置保持停止
  - Merge: 加入或切换到一个新的驾驶车道上

### 5.1.2 行为规划器输出
之前提到的几种基本的决策行为在构建基本的行为规划器时可以的，但在实际中，需要考虑更多的行为，当然考虑的行为越多，整个行为规划器的复杂度也就越大。

总的来讲，行为规划器的输出是车辆在当前环境中期望被执行的驾驶决策，伴随着这些驾驶决策，一些约束条件也会被输出，来限制后续的局部规划问题，主要包括：
  - 车辆从当前位置到达目的地的默认路径/理想路径（一般情况下都是当前车道的中心线）
  - 沿着默认路径的速度限制
  - 在正常驾驶条件下当前车道的车道边界
  - 车来在未来时刻的一些停车点（此类约束只有在相关的决策行为产生时才会出现）
  - 一些和局部路径规划高度相关的动态目标

### 5.1.3 行为规划器输入
为了获取上述输出，行为规划器需要上游几乎所有的模块为其提供输入信息：
  - 高精地图：行为规划器需要车辆周边所有的道路信息
  - 定位信息：为了更够精准的在高精地图中获取其周边环境信息
  - 任务路径：行为规划器必须知道为了到达目的地，他需要沿着哪条道路行驶
  - 所有的相关感知信息：为了能够对将要采取的驾驶动作有全面的理解，并确保其安全性
    - 环境中所有观测到的动态目标：包括其当前状态、预测路径、碰撞点、碰撞时间等
    - 环境中所有观测到的静态目标：比如停着的车、施工锥、交通灯及其状态等
    - 一个局部的占据地图：用于确定执行决策行为的安全区域

### 5.1.4 有限状态机
一旦拥有了上述所有的必要输入信息，行为规划器就需要为当前车辆选择合适的驾驶行为，并且定义必要的约束信息来保证车辆安全、高效的运动。为了实现这一目标，我们通过考虑所有的道路交通规则和与其他动态障碍的交互来构建一个显式的或隐式的规则集合。

用来表示这一规则集合并用于解决行为决策问题的传统方法是有限状态机，为了更好的理解通过有限状态机构建行为规划器的过程，我们通过一个简单的例子来切入：在一个没有交通流的交叉路口处理停车标志。

有限状态机主要包含以下组成部分：
  - 状态：代表车辆每种可能的驾驶决策行为；在本例中我们仅考虑两种行为：速度跟踪和减速至停车
    - 每种状态都会关联一个entry action，是指当某一状态被转移进入时所需要采取的操作； 
  - 转移：定义了从一个状态到另一状态的切换
    - 注意我们也可以从当前状态转移到自身，然后触发entry state来保持在当前状态
    - 每种转移都包含一系列的转移到另一状态的转移条件，当处于某一状态时，这些转移条件被持续监控，以便及时触发转移操作

当然，随着场景和行为的增加，有限状态机可以通过定义更多的状态和转移条件来变得越来越复杂。
<div align=center><img src=./figs/state_machine_1.png width=400></div>

**优势**
  - 有限状态机是一种非常简单且高效的行为规划器，我们可以认为他是行为规划定义的直接实现：通过定义策略行为或状态、局部规划约束或进入动作来满足道路约束，并且检查与环境中其他动态或静态目标的安全交互以及转移条件，实现车辆的安全决策。
  - 通过跟踪驾驶环境中的当前策略或状态，只需要考虑从当前状态出发的相关转移，在每次迭代时极大地减少了需要检查的条件；
  - 通过将行为规划分解为一系列状态和他们之间转移的集合，每个独立的规则变得相对简单，比较容易实现
  - 当然，随着状态的增加，所有可能的状态转移和转移条件的复杂度也会指数级增加，这意味当我们接近L5级的自动驾驶时，有限状态机的方法将面临诸多困难。


## 5.2 处理没有动态目标的交叉路口场景
本节我们以一个具体的场景着手，展示行为规划器的设计过程，我们要处理的场景为：
  - 一个四向的交叉口
  - 双车道
  - 每个方向上都有停车线（在图中用红线表示）
  - 在每个路口车辆有三种选择：沿路口左转、沿路口右转、直行通过路口
  - 假设没有动态目标存在
<div align=center><img src=./figs/four_way_intersection.png width=400></div>

### 5.2.1 离散化交叉口
为了能为更方便的在环境中做决策，我们首先需要对交叉路口进行离散化，主要就是将交叉口划分为几大区域：
  - Approaching an intersection: 代表车辆开始安全的减速的区域；用红色表示
  - At an intersection: 车辆必须停止进行等待继续前进的区域；用绿色表示
  - On an intersection: 车辆实际穿过交叉口的区域；用橙色表示

注意，每个区域的大小是基于两大因素动态变化的：
  - 车辆的速度：车辆的速度越大，就需要更长的距离来安全的减速停车；
  - 交叉口的尺寸：交叉口的尺寸越大，当然每个空间也就越大；
<div align=center><img src=./figs/intersection_discretize.png width=400></div>

### 5.2.2 状态机状态
为了处理这一场景，我们需要以下三个高层级的决策行为：
  - Track Speed: 这一行为仅受道路当前限速的约束，通常这一行为的触发条件为在进入交叉口的任一区域之前或进入 on the intersection区域之后；其entry action是设置限速
  - Decelerate to Stop: 该行为要求目标不断减速直至停止至某一具体停止点；entry action 定义停止点位置
  - Stop: 车辆在当前位置保持停止；entry action是启动一个定时器在穿过交叉口之前等待固定的时间

### 5.2.3 状态机转移
整个状态转移过程如下：
  - 首先，在车辆进入交叉口区域之前，对车辆的唯一限制便是车速保持在道路限速，这一限制是通过 Track Speed状态的entry action设置的；
  - 当车辆进入approaching zone时，必须减速至停车线，即状态转移至 decelerate to Stop状态；转移条件为从进入approaching zone；
  - 一旦开始减速，自动驾驶车辆的下一行为必须是在停车线之前实现完全停止；因此，车辆将停留在decelerate to stop状态直到 `速度为0` 和 `到达停止点` 这两个条件同时满足；因此decelerate to stop的entry action便是设置停止点；
  - 一旦车辆完全停止，便会进入stop状态，其entry action会启动一个定时器，比如停车3s；
  - 当计时器完成，规划器便会进入track speed state 然后根据任务规划器给出的路线通过交叉口

<div align=center><img src=./figs/state_machine_2_2.png width=600></div>

以上便是使用有限状态机处理简单的四向交叉口的全部处理流程。通过这一过程可以发现，重要的是要理解人类专业驾驶员是如何分析、理解、处理驾驶场景的，然后才足以明确行为规划器应该具有哪些能力。

### 5.2.4 处理环境噪声
另外，对于状态机性能有重要影响的一大因素就是输入的噪声，因为上述定义的状态转移条件是精准的，比如必须到达停止点且速度严格为0，即使没有其他动态障碍物，对于车辆的状态的估计通常也会包含噪声，因此，我们一般需要额外设置 noise threshold hyperparameters：
  - 比如通过一个小的阈值，允许车辆速度接近0时即可认为已经停车；

### 5.2.5 行为规划器测试
行为规划器的测试流程如下:
  - Code-based Tests: 主要是验证代码逻辑的正确性，但无法验证状态转移是否正确或状态是否能够处理所有场景
  - Simulation Tests: 在仿真环境下比如Carla中进行验证，看是否满足设计要求；可以用于验证状态转移和状态定义的正确性；在仿真中测试的场景必须涵盖我们真实环境中可能遇到的所有情况，以测试一些编程时可能忽略的边界情况
  - Closed Track Tests: 一旦证实行为规划器在仿真中满足要求，接下来就可以进行封闭场景的测试。主要用来测试在仿真中无法确认的场景，比如调参，在仿真中无法模拟真实环境中感知模块的噪声以及可能发生的错误
  - On-road Validation Tests: 当以上所有测试全部通过时，就可以进行真实的路测，以处理更多无法预料到的情况。


## 5.3 处理包含动态目标的交叉路口场景
在本小节中，我们依然处理一个四向的交叉路口，不过这次需要额外处理包含动态目标，特别是动态车辆的情况。

为了能够安全的处理这些动态车辆，首先要求我们能够获取如下信息：
  - 距离动态目标的距离：即当前车辆的位置距离动态目标中心点之间的欧氏距离
  - 距离两车碰撞点的距离：当前车辆与其他动态目标可能发生碰撞的位置之间的距离
  - 碰撞时间：到达碰撞点的时间
<div align=center><img src=./figs/dynamic_object_distance.png width=200></div>

### 5.3.1 有限状态机状态
接下来我们通过对之前设计的有限状态机进行扩展，我们通过加入一个新的决策行为，使之能够处理新场景下与动态车辆的交互问题。

我们在原来 Track Speed, Decelerate to Stop, Stop 状态的基础上，新加入Follow Learder 状态：
  - 这一决策状态要求车辆能够与lead vehicle保持安全距离的前提下，其自身速度与之匹配实现跟车行为
  - Leader vehicle 是指当前车辆所在车道内正前方的车辆
  - 安全距离的大小和速度相关，不论是安全速度和安全距离，都是行为规划器在每次迭代过程中通过entry action 进行更新的

### 5.3.2 有限状态机转移
和之前的研究步骤相同，我们从某一状态出发，然后通过确定状态转移条件，不断将状态转移至其他状态。

**Track Speed**  
我们从车辆位于交叉路口区域之外开始考虑，则首先将处于 Track Speed 状态，与之前情况类似，只有当车辆处于Approaching zone时，才会转移至 Decelerate to Stop 状态
  - 但这里我们需要额外考虑此时有其他车辆即将变道进入或已经位于本车前方这一情况，此时，我们将进行 follow check 来决定是否转移至Follow Leader状态
  - Follow Check主要分为两部分完成：
    - Distance Check: 主要用于确认距离前方车辆是否足够近来判断是否应该跟车: 评价指标为之前提到的 距离动态目标距离
    - Same Lane Check: 确认前方车辆是否确实和自己处于同一车道: 评价指标为检查前车是否满足车道限制以及其朝向和本车运动方向夹角是否在某一阈值内；
<div align=center><img src=./figs/state_machine_3_track_speed.png width=600></div>

**Follow Leader**  
在本状态，我们定义两种转移：
  - 首先第一种情况是在本车接近交叉口之前，前车可能离开本车道，因此可以再次切换回 Track Speed 状态
  - 第二种情况则更为普遍，即前车离开当前车道进入交叉口，而此时本车也已经进入Approaching zone，则应该直接转移至 Decelerate to Stop 状态；
<div align=center><img src=./figs/state_machine_3_follow_leader.png width=600></div>

**Decelerate to Stop**  
正常情况下和上节情况与一致，在本状态下，车辆将保持本状态知道到达停止线，然后切换进入Stop状态。但当考虑动态目标时，我们要考虑此时有车辆切入的情况：
  - 和track speed 状态的处理方式类似，我们通过执行 Follow Check判断是否需要切换回 Follow Leader 状态
  - 比如发现二者碰撞距离小于距离停车线的距离，则应该立即转移进入跟车状态避免碰撞。
 <div align=center><img src=./figs/state_machine_3_decelerate_to_stop.png width=600></div>

**Stop**  
为了简化问题的处理流程，我们采取非常保守的驾驶策略，等所有车辆全部离开交叉口区域时才能继续前进，包括 approaching, at, on Intersection Zone。但所有车辆清空并不意味着整个交叉口没有任何车辆，而是指在可能影响本车接下来前进路线的区域不能有车辆存在（图示可能不准确）：
  - 当本车需要直行时，需要等待从车辆左侧和右侧进入交叉口的动态车辆"离开"
  - 当本车需要左转时，需要等待从车辆左侧、右侧、对面方向的进入交叉口的车辆“离开”
  - 当本车需要右转时，需要等待从车辆左侧进入交叉口的动态车辆“离开” 
<div align=center><img src=./figs/intersection_turn.png width=600></div>

刚才提到了左侧右侧的概念，其精确定义如下：即相对于车辆自身坐标系，当其他车辆航向与自身车辆航向之间的相对夹角处于
  - [-45,45]：两车前进方向一致；
  - [45, 135]：相对车辆左转
  - [135, -135]：和车辆相向而行
  - [-45, -135]：相对车辆右转
  
最后状态转移如下图所示，我们有两种转移方式可供选择：Follow Leader 或是 Track Speed, 取决于当前是否有车辆在车道内并且是否满足Follow Check。不管是那种情况，再具体执行时可具体依据任务规划给出的路径。

<div align=center><img src=./figs/state_machine_3_stop.png width=600></div>
 

### 5.3.3 进一步提升
最终完整的有限状态机如下图所示，但实际上此有限状态机是无法用于实际的无人驾驶车辆的，因为为了展示整个问题的处理过程，我们在设计中对问题进行了过度的见简化处理，在实际很多场景中，都很容易出现问题：
  - 第一个例子是当司机无意中转向迎面而来的车辆，进入当前车辆的车道。这实际上发生在 2018 年的一辆 Waymo 货车上，当时一名司机冲过中线进入迎面而来的车流
  - 另一个例子是一个激进的司机在十字路口加速，即使当前车辆已经开始驶过它。
  - 另一个常见的例子是车辆未能在十字路口停下来
  - 最后，还有停在十字路口附近的车辆需要考虑。如果这辆车没有被标记为停放，我们的行为规划器可能会陷入死锁状态，等待这辆停放的车辆移动

<div align=center><img src=./figs/state_machine_3.png width=600></div>

这绝不是所有可能性的完整集合，行为安全评估和测试的主要目标之一是尽可能多地发现意外行为的变化，以便它们也可以被检测、分类并纳入行为规划设计过程。然而，仅仅发现边缘情况是不够的。相反，我们必须定义自动驾驶汽车应该如何应对这些情况中的每一种。对于这种紧急机动，例如转弯或紧急刹车，需要定义更多的过渡和条件。这是一个活跃的研究和开发领域，需要不断的探索。


## 5.4 同时处理多种场景
目前为止，我们已经构建了一个有限状态机用于处理四向车道且包含动态障碍物的场景，但我们仍有大量的典型交通场景没有解决，如三向交叉口、交通灯控制的交叉口、直线场景等。尽管这些场景由于处理逻辑类似，有很大的相似性，但在实际设计中依然需要设计大量不同的基础驾驶行为。

<div align=center><img src=./figs/multi_scenarios.png width=600></div>

处理多种场景的直观想法就是往一个状态机中不断加入状态和转移关系以适应不断出现的新场景，但这种方案存在以下问题：
  - 首先就是我们需要开发额外的逻辑来区分当前的场景，并且为每个场景独立的设计对应的规则，这将很快引发著名的规则爆炸问题，随着场景的增加，所需要的规则的数量将爆炸性的增加
  - 其次就是单一的状态机在每一步都需要评估额外的规则和转移，这使得计算时间也显著增加
  - 最后这个复杂系统实际上很难建立和维护，实际上，一旦其复杂度增加，我们就已经失去了最开始使用有限状态机的优势

### 5.4.1 多个状态机
另一种方案就是提升抽象层级，将每一种场景当做状态，这样我们在场景之间的切换将十分简单。比如我们之前已经分别单独解决的 Drive-lane Scenario 和 Intersection Scenario，我们首先将这个场景当做高层级的场景状态，他们之间建立状态转移关系，然后再独立保存能够具体处理这些场景的低层级的状态机。这种方法被称为分层状态机，其有两个核心组件：
  - super-states： 用来表示每个场景
  - sub-states： 用来表示每个具体场景中的决策行为 
  - 场景之间的转移：同样是基于高精地图信息和动态车辆信息通过定义规则确定何时应当进入一个新场景。比如为了从straight road 场景切换进入stop sign intersection，自动驾驶车辆需要足够接近交叉口，具体可以通过沿着任务规划的轨迹通过距离检查实现。
<div align=center><img src=./figs/multi_state_machine.png width=600></div>

**方案设计**  
刚才提到的都是概念上的场景层次的切换，但具体我们在某一场景中执行具体的sub-state maneuvers时如何切换至另一场景呢？我们可以给某些关键的行为提供状态转移，让其从当前场景的sub-states跳出至super state状态：
  - 首先还是以交叉路口场景为例，我们需要为此场景选择关键的退出状态，我们退出此场景的唯一方式就是通过Track Speed 或 Follow Leader 通过此路口，因此我们将退出状态转移放在此处
  - 执行状态转移的条件是需要确定此场景确实已经执行完毕，我们可以利用距离下一个交叉口stop sign的距离来判断，当其大于某一阈值时，我们便可放心的退出交叉路口场景；
  - 利用这种方式实现状态转移，我们也能够在场景切换时保持行为的一致性，比如在本例中，交叉路口场景下的super state的track speed 行为将会直接切换到下一场景的track speed状态。
<div align=center><img src=./figs/entry_exit_transition.png width=600></div>

更进一步，我们可以继续创建一个新的super-state 节点，往此分层状态机中继续添加一个多车道的场景，对应的也需要一个sub-state 状态机用于处理此场景。
<div align=center><img src=./figs/hierarchical_state_machine.png width=600></div>

**优劣比较**
  - 通过场景分离，为每个场景创建独立的状态机，能够极大地减少计算时间
  - 并且创建和维护过程也更为简单
  - 尽管如此，分层状态机仍然要限制规则的数量，否则也会面临规则爆炸的问题
  - 虽然分层状态机相比于单一的状态机已经能够允许创建更多的规则，但每个场景都独立创建各自的状态机，在不同场景下的类似的行为存在较多的重复规则，从某个场景key state向其他场景状态的转移也是巨大的，因此最终能够处理的场景其实也是有限的 


## 5.5 行为规划高级方法
在之前的章节中我们着重介绍了基于有限状态机的行为规划器，但其具有如下缺点：
 - 规则爆炸：当我们处理的场景增加时，其对应所需要的规则和行为急剧的增加；也就是说，有限状态机仅能解决基于受限行为的部分场景，试图用其实现L4 或 L5 级别的自动驾驶是不可能的。
 - 环境噪声：在之前的章节中我们通过添加一些超参数来解决噪声的问题，但这种方式仅能用于解决部分受限场景，要想真正能够解决所有类型的输入不确定性，还需要其他方法
 - 超参数调参：显然，行为越复杂，所需要的超参数就越多
 - 无法处理没有见过的场景

### 5.5.1 专家系统
专家系统是指通过人类专家设计和维护的系统，状态机其实就是专家系统的一种，当然还有其他专家系统，比如基于规则的系统，将规则数据库应用于每一时刻的输入数据来产生对应决策行为：
  - 这些规则形成了一个层次结构，其中要保证安全性准则优先，其凌驾于防御性的驾驶策略、舒适性规则和正常的行为规则之上；
  - 每一个规则只有当合适的条件出现时才会被使用，用于影响输出行为的选择
  - 这种规则库并不存在分层状态机中面临的规则重复的问题：As the rules can apply throughout the ODD or over significant portions of it. 
  - 但基于规则的系统必须谨慎的扩充每一条规则，以避免规则之间产生负面影响，或同时激活多条规则从而产生意外的输出
  - 当然，和所有基于人类专家设计的系统类似，其同样面临无法解决所有场景的问题

### 5.5.2 模糊逻辑
解决上述部分问题的方法之一是将人类专家规则扩展或结合模糊逻辑。模糊逻辑是一个系统，它通过一系列清晰、明确定义的值来创建更为连续的模糊状态集合。以跟车行为为例：
  - 之前我们通过参数化距离来将空间简单的分为跟车或不跟车
  - 但使用模糊逻辑，我们可以在一段连续的空间上应用不同的规则，比如当距离前车很近时，我们的反应会更加激进，但当距离较远时，我们对于速度匹配和距离的要求就可以不用那么关心
  - 还有就是基于模糊逻辑，能够更好的处理环境噪声
<div align=center><img src=./figs/fuzzy_logic.png width=600></div>

但此类系统同样面临规则爆炸和参数调优问题，甚至因为其模糊逻辑的存在，此类问题更为严重！！！


### 5.5.3 强化学习
强化学习是机器学习的形式之一，智能体通过采取动作与环境进行交互并收到连续的奖励，通过在仿真中不断学习失败的经验，从而学会某类任务。更为具体的，智能体期望学习一个策略 $p$，该策略将给定的环境状态$s$, 映射到动作$a$。由于场景输入的多样性，直接通过强化学习进行行为规划不太可能成功。
<div align=center><img src=./figs/reinforcement_learning.png width=600></div>

但目前也有其他一些改进：
  - 比如分层强化学习:
    - 首先与分层有限状态机类似，将问题分为基于行为空间的低层级策略和基于场景的高层级策略
    - 然后每个低层级的策略分别独立学习，只有当成功学习到了高层级的策略才能完成对一个完整场景的学习
  - 第二种方案是使用基于模型的强化学习，在此方法中，智能体不仅仅尝试学习策略，同时也需要学习智能体周围当前环境的模型，比如如果智能体能够学习到周围动态车辆的运动模型，将能够规划出更有效的行为；
<div align=center><img src=./figs/reinforcement_learning_others.png width=600></div>

虽然强化学习很有前景，但仍然有他自己的问题：
  - 很多用于学习策略的仿真环境过于简单，因此从中学习到的策略很难直接迁移到真实环境中
  - 而过度真实的仿真器又会导致对计算要求较高的问题
  - 还有就是安全性的问题，虽然目前有一些技术来确保强化学习器产生的个轨迹满足安全性约束，但其学习系统黑箱的性质还是无法决策行为提供严谨的评估

### 5.5.4 机器学习
还有一些方法试图从人类驾驶动作中进行学习，比如逆强化学习：逆强化学习不再通过给定奖励函数来学习策略，其利用人类驾驶数据作为策略，然后试图学习人类的奖励函数，这样一旦奖励函数能够学习得到，那么就可以根据此做出和人类类似的决策行为。
<div align=center><img src=./figs/machine_learning.png width=600></div>

最后，端到端方法将原始传感器数据作为输入，并尝试输出油门、刹车和转向命令。 再次通过模仿学习方法从人类驾驶命令中学习。 这种方法是由 Nvidia 的研究人员在他们的论文“自动驾驶汽车的端到端学习”中开创的。 虽然这没有明确归类为行为规划，但端到端方法仍然隐式地执行行为选择任务，作为其输出选择过程的一部分。 

这些简短的解释只是触及了一个庞大且快速发展的研究领域的皮毛，行为规划仍然是自动驾驶研究活动的温床之一，并且是实现现实世界L5级自动驾驶最艰难的瓶颈之一。


## 5.6 补充阅读材料
  - [1]. J. Wei, J. M. Snider, T. Gu, J. M. Dolan, and B. Litkouhi, “[A behavioral planning framework for autonomous driving](https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=6856582),” 2014 IEEE Intelligent Vehicles Symposium Proceedings, 2014. This gives a nice overview of an example framework that can be used in behaviour planning.
  - [2]. R. S. Sutton and A. G. Barto, [Reinforcement learning an introduction](http://incompleteideas.net/book/the-book-2nd.html). Cambridge: A Bradford Book, 1998. Gives a great introduction to reinforcement learning concepts.